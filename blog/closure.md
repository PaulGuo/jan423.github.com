# 闭包 Closure

我一直认为闭包是一种函数。但是这个效果为什么叫closure（闭包），我一直很纳闷。

> 函数对象可以通过作用域链相互关联起来，函数体内部的变量可以保存在函数体内，这种特型在计算机科学文献里称为“闭包”.

> -------javascript权威指南 P182 闭包

## 函数的作用域

有些语言（如：Java）的函数调用过程中局部变量保存在一个栈中，当function 执行完return后栈中的变量就销毁了。

但是javascript的function在执行过程中局部变量是保存在一个**对象**中的，不是在**栈**这种数据结构中。正是因为变量保存在一个对象中才造成了闭包这个效果。


###局部变量对象的组成

this arguments 变量

## javascript的作用域链
每段代码都有在**定义**时期会创建一个叫作用域链的链表对象，注意哦它是一个对象，然后这个对象会被这个作用域中的特殊内部属性[[scope]]引用。在执行时会产生那个**局部变量对象**会发在那个作用域链的链表对象第一位，所以查找变量时会第一时刻从第一位的局部变量对象中找。当函数执行完成后其作用域链会变为定义时状态。

一般情况下函数执行完后GC发现那个保存局部变量的对象没有被引用就回收了。但是如果这个对象被引用了那么就可以发生一些奇特的事。

	function father(){
		var a=1;
		return function(){
			return a;
		}
	}
	var a=father();

father执行后返回一个匿名函数，但是这个匿名函数作用域链的第二位会引用father的变量对象。只要这个匿名函数不执行完，不修改自己的作用域链。那么father变量对象占用的内存一直无法释放。
在这里a引用这个匿名对象。很显然father无法释放内存。除非

	(function father(){
		var a=1;
		return function(){
			return a;
		}
	})()()

